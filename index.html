<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>TechAura - Web Threat Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.23.0/cytoscape.min.js"></script>
    <script src="https://unpkg.com/webcola/WebCola/cola.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-cola@2.5.1/cytoscape-cola.min.js"></script>
    <style>
        body { background: linear-gradient(135deg, #0f172a 0%, #172554 50%, #0f172a 100%); min-height: 100vh; color: #e2e8f0; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(56, 189, 248, 0.1); box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: rgba(59, 130, 246, 0.5); border-radius: 4px; }
        #cy { width: 100%; min-height: 400px; height: 55vh; background: rgba(15, 23, 42, 0.5); border-radius: 8px; border: 1px solid rgba(56, 189, 248, 0.1); }
        .risk-low { background: rgba(16, 185, 129, 0.2); color: #34d399; border: 1px solid #10b981; padding: 6px 16px; border-radius: 999px; font-weight: 700; }
        .risk-med { background: rgba(245, 158, 11, 0.2); color: #fbbf24; border: 1px solid #f59e0b; padding: 6px 16px; border-radius: 999px; font-weight: 700; }
        .risk-high { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid #ef4444; padding: 6px 16px; border-radius: 999px; font-weight: 700; }
        .timeline { padding: 10px; margin: 6px 0; border-left: 3px solid #3b82f6; background: rgba(30, 41, 59, 0.4); border-radius: 0 4px 4px 0; font-size: 11px; }
        .timeline.ok { border-left-color: #10b981; }
        .timeline.warn { border-left-color: #f59e0b; }
        .timeline.err { border-left-color: #ef4444; }
        .scroll { max-height: 350px; overflow-y: auto; }
        .card { background: rgba(30, 41, 59, 0.6); border-radius: 6px; padding: 12px; border: 1px solid rgba(255, 255, 255, 0.05); margin-bottom: 8px; }
        .tag { display: inline-block; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); padding: 4px 8px; border-radius: 4px; font-size: 11px; margin: 2px; }
    </style>
</head>
<body class="p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <div class="glass rounded-xl p-6 mb-6">
            <h1 class="text-3xl font-extrabold text-white mb-2"><span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">TechAura</span></h1>
            <p class="text-slate-400">Advanced threat analysis with 23+ CORS proxies & deep metadata</p>
        </div>

        <div class="glass rounded-xl p-5 mb-6">
            <div class="flex gap-3 mb-3">
                <input type="text" id="urlInput" placeholder="Enter URL" value="https://example.com" class="flex-1 px-4 py-3 bg-slate-900/50 border border-slate-700 text-white rounded-lg focus:ring-2 focus:ring-blue-500"/>
                <button id="analyzeBtn" class="px-8 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-bold rounded-lg hover:from-blue-700 hover:to-cyan-700">Analyze</button>
            </div>
            <div class="text-xs text-cyan-500/80 bg-cyan-500/10 p-2 rounded border border-cyan-500/20">‚ÑπÔ∏è 23+ CORS proxies with auto-fallback. Advanced threats + metadata.</div>
        </div>

        <div id="results" style="display: none;">
            <div class="glass rounded-xl p-6 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
                    <div class="flex-1">
                        <h2 class="text-xl font-bold text-white mb-3">Risk Assessment</h2>
                        <div id="scoreBreakdown" class="text-sm text-slate-300 bg-black/20 p-3 rounded"></div>
                    </div>
                    <div class="flex items-center gap-6 justify-center md:justify-end border-t md:border-t-0 md:border-l border-white/10 pt-4 md:pt-0 md:pl-6">
                        <div class="text-center">
                            <div class="text-6xl font-extrabold text-white" id="riskScore">--</div>
                            <div class="text-xs text-slate-500 uppercase mt-1">Score</div>
                        </div>
                        <div id="riskBadge" class="risk-low">Ready</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 space-y-6">
                    <div class="glass rounded-xl p-5 border-l-4 border-red-500/50">
                        <h3 class="text-lg font-bold text-white mb-3">üõ°Ô∏è Threats</h3>
                        <div id="threatSummary" class="text-sm space-y-1"></div>
                    </div>
                    <div class="glass rounded-xl p-5">
                        <h3 class="text-lg font-bold text-white mb-2">üì° Log</h3>
                        <div id="timeline" class="scroll text-slate-300 font-mono text-xs"></div>
                    </div>
                    <div class="glass rounded-xl p-5">
                        <h3 class="text-lg font-bold text-white mb-2">üìä Metadata</h3>
                        <div id="metaContent" class="text-xs text-slate-400 scroll"></div>
                    </div>
                </div>

                <div class="lg:col-span-2 space-y-6">
                    <div class="glass rounded-xl p-1">
                        <div class="bg-slate-900/80 p-3 rounded-t-lg border-b border-white/5 flex justify-between items-center">
                            <h3 class="font-bold text-white text-sm">Dependency Graph</h3>
                            <div class="flex gap-3 text-xs">
                                <span><span class="w-2 h-2 rounded-full bg-emerald-500 inline-block"></span> Safe</span>
                                <span><span class="w-2 h-2 rounded-full bg-amber-500 inline-block"></span> 3rd</span>
                                <span><span class="w-2 h-2 rounded-full bg-red-500 inline-block"></span> High</span>
                            </div>
                        </div>
                        <div id="cy"></div>
                    </div>
                    <div class="glass rounded-xl p-5">
                        <h3 class="text-lg font-bold text-white mb-3">üìã Details</h3>
                        <div id="detailedFindings" class="scroll"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CORS_PROXIES = [
            { url: 'https://api.allorigins.win/raw?url=', format: 'encoded' },
            { url: 'https://corsproxy.io/?', format: 'direct' },
            { url: 'https://cors-anywhere.herokuapp.com/', format: 'direct' },
            { url: 'https://jsonp.afeld.me/?url=', format: 'encoded' },
            { url: 'https://thingproxy.freeboard.io/fetch/', format: 'direct' },
            { url: 'https://proxy.cors.sh/', format: 'direct' },
            { url: 'https://api.codetabs.com/v1/proxy?quest=', format: 'direct' },
            { url: 'https://cache.header.appspot.com/', format: 'direct' },
            { url: 'https://wildcard.crossorigin.me/', format: 'direct' },
            { url: 'https://cors-proxy.htmldriven.com/?url=', format: 'encoded' },
            { url: 'https://crossorigin.me/', format: 'direct' },
            { url: 'https://geturl.herokuapp.com/?url=', format: 'encoded' },
            { url: 'https://yacdn.org/serve/', format: 'direct' },
            { url: 'https://proxy.webxcess.net/?url=', format: 'encoded' },
            { url: 'https://cors.io/?', format: 'direct' },
            { url: 'https://http-cors-proxy.herokuapp.com/?url=', format: 'encoded' },
            { url: 'https://allorigins.win/raw?url=', format: 'encoded' },
            { url: 'https://cros-proxy.herokuapp.com/?url=', format: 'encoded' },
            { url: 'https://proxy-server.herokuapp.com/request?url=', format: 'encoded' },
            { url: 'https://cors.bridged.cc/', format: 'direct' },
            { url: 'https://api.proxies.cors.sh/?url=', format: 'encoded' },
            { url: 'https://proxy.example.com/', format: 'direct' },
            { url: 'https://noxious.herokuapp.com/', format: 'direct' },
        ];
        
        const KNOWN_TRACKERS = ['google-analytics', 'googletagmanager', 'facebook.net', 'facebook.com', 'doubleclick', 'googlesyndication', 'hotjar', 'segment.com', 'segment.io', 'mixpanel', 'tiktok.com', 'adservice', 'pixel', 'beacon', 'clarity.ms', 'criteo', 'outbrain', 'taboola', 'amplitude', 'matomo', 'chartbeat', 'disqus', 'new relic', 'pingdom', 'cdn', 'optimizely'];
        
        const SUSPICIOUS_KEYWORDS = ['eval', 'new Function', 'atob', 'btoa', 'document.write', 'innerHTML', 'fromCharCode', 'unescape', 'exec', 'Function.constructor', 'setTimeout', 'setInterval', 'XMLHttpRequest', 'fetch', 'WebSocket', 'crypto-js', 'obfuscate', 'minify', 'uglify', 'base64', 'charCodeAt', 'replace', 'split', 'String.fromCharCode', 'encodeURIComponent', 'decodeURIComponent', 'JSON.parse'];

        let analysisData = { targetUrl: '', targetDomain: '', scripts: [], iframes: [], meta: {}, riskScore: 0 };

        function escapeHtml(text) {
            if (!text) return '';
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return text.replace(/[&<>"']/g, c => map[c]);
        }

        function resolveUrl(url, base) {
            try { return new URL(url, base).href; } catch (e) { return url; }
        }

        function calculateEntropy(str) {
            if (!str || str.length === 0) return 0;
            const freq = {};
            for (let c of str) freq[c] = (freq[c] || 0) + 1;
            let entropy = 0;
            for (let c in freq) entropy -= (freq[c] / str.length) * Math.log2(freq[c] / str.length);
            return parseFloat(entropy.toFixed(2));
        }

        function extractDomain(url) {
            try { return new URL(url).hostname; } catch (e) { return 'unknown'; }
        }

        function isTracker(domain) {
            if (!domain) return false;
            return KNOWN_TRACKERS.some(t => domain.toLowerCase().includes(t.toLowerCase()));
        }

        function detectSuspiciousPatterns(code) {
            const found = [];
            const lowerCode = (code || '').toLowerCase();
            for (let kw of SUSPICIOUS_KEYWORDS) {
                const regex = new RegExp('\\b' + kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                if (regex.test(lowerCode)) found.push(kw);
            }
            if (/[A-Za-z0-9+/]{60,}={0,2}/.test(code)) found.push('Long Base64');
            if (/\\x[0-9a-f]{2}/i.test(code)) found.push('Hex encoding');
            if (/\\u[0-9a-f]{4}/i.test(code)) found.push('Unicode escape');
            if (/var\s+\w+\s*=\s*function/i.test(code)) found.push('Dynamic function');
            if (/window\[/.test(code)) found.push('Dynamic property');
            if (/document\[/.test(code)) found.push('Dynamic DOM access');
            return [...new Set(found)].slice(0, 10);
        }

        function addTimelineEvent(msg, type = 'info') {
            const timeline = document.getElementById('timeline');
            const item = document.createElement('div');
            item.className = `timeline ${type === 'success' ? 'ok' : (type === 'error' ? 'err' : 'warn')}`;
            item.innerHTML = `<div>${escapeHtml(msg)}</div><div class="text-[9px] opacity-70">${new Date().toLocaleTimeString()}</div>`;
            timeline.appendChild(item);
            timeline.scrollTop = timeline.scrollHeight;
        }

        async function fetchWithProxies(url) {
            addTimelineEvent(`Fetching ${url}...`, 'info');
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 3000);
                const resp = await fetch(url, { signal: controller.signal });
                if (resp.ok) {
                    addTimelineEvent('‚úì Direct access', 'success');
                    return await resp.text();
                }
            } catch (e) {
                addTimelineEvent('Direct blocked. Trying proxies...', 'warning');
            }

            for (let i = 0; i < CORS_PROXIES.length; i++) {
                try {
                    const proxy = CORS_PROXIES[i];
                    const proxyUrl = proxy.format === 'encoded' ? proxy.url + encodeURIComponent(url) : proxy.url + url;
                    addTimelineEvent(`Proxy ${i+1}/${CORS_PROXIES.length}...`, 'info');
                    
                    const controller = new AbortController();
                    setTimeout(() => controller.abort(), 5000);
                    const resp = await fetch(proxyUrl, { signal: controller.signal, headers: { 'User-Agent': 'Mozilla/5.0' } });
                    
                    if (resp.ok) {
                        const html = await resp.text();
                        if (html && html.length > 100) {
                            addTimelineEvent(`‚úì Proxy ${i+1}: ${(html.length/1024).toFixed(1)}KB`, 'success');
                            return html;
                        }
                    }
                } catch (e) {
                    addTimelineEvent(`Proxy ${i+1}: fail`, 'warning');
                }
            }
            throw new Error('All proxies failed');
        }

        async function fetchAndParse(url) {
            try {
                const html = await fetchWithProxies(url);
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const base = document.createElement('base');
                base.href = url;
                if(doc.head) doc.head.appendChild(base);
                return { doc, html };
            } catch (e) {
                addTimelineEvent(`‚úó Failed: ${e.message}`, 'error');
                throw e;
            }
        }

        function extractScripts(doc, targetDomain, baseUrl) {
            const scripts = [];
            doc.querySelectorAll('script').forEach((script, idx) => {
                const src = script.getAttribute('src');
                const inline = script.textContent;
                if (src) {
                    const fullSrc = resolveUrl(src, baseUrl);
                    const domain = extractDomain(fullSrc);
                    scripts.push({ type: 'external', src: fullSrc, domain, isThirdParty: domain !== targetDomain && domain !== 'unknown', isTracker: isTracker(domain), suspicious: [] });
                } else if (inline && inline.trim()) {
                    const entropy = calculateEntropy(inline);
                    const suspicious = detectSuspiciousPatterns(inline);
                    scripts.push({ type: 'inline', code: inline.substring(0, 150), entropy, suspicious, isThirdParty: false, isTracker: false });
                }
            });
            return scripts;
        }

        function extractIframes(doc, targetDomain, baseUrl) {
            const iframes = [];
            doc.querySelectorAll('iframe').forEach(iframe => {
                const src = iframe.getAttribute('src');
                if (src) {
                    const fullSrc = resolveUrl(src, baseUrl);
                    const domain = extractDomain(fullSrc);
                    iframes.push({ src: fullSrc, domain, isThirdParty: domain !== targetDomain, isTracker: isTracker(domain) });
                }
            });
            return iframes;
        }

        function extractMetadata(doc) {
            const meta = {
                title: doc.title || 'N/A',
                description: '', keywords: '', author: '', viewport: '', lang: doc.documentElement.lang || 'N/A',
                ogTitle: '', ogDescription: '', ogImage: '', twitterCard: '', canonical: '', robots: '', customMeta: []
            };

            doc.querySelectorAll('meta').forEach(m => {
                const name = m.getAttribute('name') || m.getAttribute('property') || m.getAttribute('http-equiv');
                const content = m.getAttribute('content');
                if (!name || !content) return;
                const lowerName = name.toLowerCase();
                if (lowerName.includes('description')) meta.description = content;
                else if (lowerName.includes('keyword')) meta.keywords = content;
                else if (lowerName.includes('author')) meta.author = content;
                else if (lowerName.includes('viewport')) meta.viewport = content;
                else if (lowerName.includes('robots')) meta.robots = content;
                else if (lowerName.includes('og:title')) meta.ogTitle = content;
                else if (lowerName.includes('og:description')) meta.ogDescription = content;
                else if (lowerName.includes('og:image')) meta.ogImage = content;
                else if (lowerName.includes('twitter:card')) meta.twitterCard = content;
                else meta.customMeta.push({ name, content: content.substring(0, 80) });
            });

            doc.querySelectorAll('link[rel="canonical"]').forEach(link => {
                meta.canonical = link.getAttribute('href');
            });

            return meta;
        }

        function buildGraph() {
            const elements = [{ data: { id: 'root', label: analysisData.targetDomain, risk: 'root' } }];

            analysisData.scripts.forEach((script, idx) => {
                if(script.type === 'external') {
                    const id = `s_ext_${script.domain.replace(/\./g, '_')}_${idx}`;
                    let risk = 'low';
                    if (script.isTracker) risk = 'high';
                    else if (script.isThirdParty) risk = 'medium';
                    elements.push({ data: { id, label: script.domain, risk } });
                    elements.push({ data: { source: 'root', target: id } });
                } else {
                    if (script.entropy > 5 || script.suspicious.length > 0) {
                        const id = `s_in_${idx}`;
                        elements.push({ data: { id, label: 'Inline JS', risk: 'high' } });
                        elements.push({ data: { source: 'root', target: id } });
                    }
                }
            });

            analysisData.iframes.forEach((iframe, idx) => {
                const id = `frm_${idx}`;
                const risk = iframe.isTracker ? 'high' : (iframe.isThirdParty ? 'medium' : 'low');
                elements.push({ data: { id, label: iframe.domain, risk } });
                elements.push({ data: { source: 'root', target: id } });
            });

            document.getElementById('cy').innerHTML = '';
            cytoscape({
                container: document.getElementById('cy'),
                elements,
                style: [
                    { selector: 'node', style: { label: 'data(label)', color: '#fff', 'font-size': '9px', width: '50px', height: '50px', 'border-width': 2, 'border-color': 'rgba(255,255,255,0.2)' } },
                    { selector: 'node[risk="root"]', style: { 'background-color': '#3b82f6', width: 65, height: 65 } },
                    { selector: 'node[risk="low"]', style: { 'background-color': '#10b981' } },
                    { selector: 'node[risk="medium"]', style: { 'background-color': '#f59e0b' } },
                    { selector: 'node[risk="high"]', style: { 'background-color': '#ef4444' } },
                    { selector: 'edge', style: { width: 1, 'line-color': 'rgba(255,255,255,0.2)', 'curve-style': 'bezier' } }
                ],
                layout: { name: 'cola', animate: true, maxSimulationTime: 1500, nodeSpacing: 30, edgeLengthVal: 80 }
            });
            addTimelineEvent('‚úì Graph rendered', 'success');
        }

        async function analyzeWebsite() {
            const btn = document.getElementById('analyzeBtn');
            const input = document.getElementById('urlInput');
            let url = input.value.trim();
            if (!url) { alert('Enter URL'); return; }
            if (!url.startsWith('http')) { url = 'https://' + url; input.value = url; }

            btn.disabled = true;
            btn.textContent = 'Analyzing...';
            document.getElementById('results').style.display = 'block';
            document.getElementById('timeline').innerHTML = '';
            analysisData = { targetUrl: url, targetDomain: extractDomain(url), scripts: [], iframes: [], meta: {}, riskScore: 0 };

            try {
                const { doc } = await fetchAndParse(url);
                analysisData.scripts = extractScripts(doc, analysisData.targetDomain, url);
                analysisData.iframes = extractIframes(doc, analysisData.targetDomain, url);
                analysisData.meta = extractMetadata(doc);
                
                let score = 0, breakdownHtml = '';
                const extScripts = analysisData.scripts.filter(s => s.type === 'external');
                score += Math.min(extScripts.length * 2, 30);
                breakdownHtml += `<div>‚Ä¢ Scripts: ${extScripts.length} (+${Math.min(extScripts.length * 2, 30)})</div>`;

                const trackers = [...analysisData.scripts, ...analysisData.iframes].filter(x => x.isTracker);
                score += trackers.length * 15;
                if(trackers.length > 0) breakdownHtml += `<div class="text-red-400">‚Ä¢ Trackers: ${trackers.length} (+${trackers.length * 15})</div>`;

                const susp = analysisData.scripts.filter(s => s.suspicious && s.suspicious.length > 0);
                score += susp.length * 10;
                if(susp.length > 0) breakdownHtml += `<div class="text-amber-400">‚Ä¢ Suspicious: ${susp.length} (+${susp.length * 10})</div>`;

                const highEntropy = analysisData.scripts.filter(s => s.entropy && s.entropy > 5);
                score += highEntropy.length * 8;
                if(highEntropy.length > 0) breakdownHtml += `<div class="text-orange-400">‚Ä¢ High Entropy: ${highEntropy.length} (+${highEntropy.length * 8})</div>`;

                analysisData.riskScore = Math.min(score, 100);
                document.getElementById('scoreBreakdown').innerHTML = breakdownHtml;
                document.getElementById('riskScore').textContent = analysisData.riskScore;
                
                const badge = document.getElementById('riskBadge');
                if (score < 30) { badge.className = 'risk-low'; badge.textContent = 'Low Risk'; }
                else if (score < 70) { badge.className = 'risk-med'; badge.textContent = 'Medium Risk'; }
                else { badge.className = 'risk-high'; badge.textContent = 'High Risk'; }

                const metaHtml = `<div class="border-b border-white/10 pb-2 mb-2"><strong class="text-blue-400">Title:</strong> ${escapeHtml(analysisData.meta.title)}<br><strong class="text-blue-400">Lang:</strong> ${analysisData.meta.lang}</div><div class="border-b border-white/10 pb-2 mb-2"><strong class="text-green-400">Desc:</strong> ${escapeHtml((analysisData.meta.description || '').substring(0, 80))}<br><strong class="text-green-400">Keys:</strong> ${escapeHtml((analysisData.meta.keywords || '').substring(0, 60))}</div><div class="border-b border-white/10 pb-2 mb-2"><strong class="text-purple-400">OG:</strong> ${analysisData.meta.ogImage ? '‚úì' : '‚úó'}<br><strong class="text-cyan-400">Security:</strong> Robots: ${analysisData.meta.robots ? '‚úì' : '‚úó'} | Canon: ${analysisData.meta.canonical ? '‚úì' : '‚úó'}</div>${analysisData.meta.customMeta.length > 0 ? `<div><strong class="text-yellow-400">Custom:</strong><br>${analysisData.meta.customMeta.slice(0, 4).map(m => `<span class="tag">${escapeHtml(m.name)}</span>`).join('')}</div>` : ''}`;
                document.getElementById('metaContent').innerHTML = metaHtml;

                const threats = [];
                if(trackers.length) threats.push(`<div class="text-red-400 text-xs">üîç ${trackers.length} trackers</div>`);
                if(susp.length) threats.push(`<div class="text-amber-400 text-xs">‚ö†Ô∏è ${susp.length} suspicious</div>`);
                if(highEntropy.length) threats.push(`<div class="text-orange-400 text-xs">üîê ${highEntropy.length} obfuscated</div>`);
                if(analysisData.iframes.filter(f => f.isThirdParty).length > 3) threats.push(`<div class="text-yellow-400 text-xs">üóÇÔ∏è Many iframes</div>`);
                document.getElementById('threatSummary').innerHTML = threats.length ? threats.join('') : '<div class="text-green-400 text-xs">‚úì No major threats</div>';

                document.getElementById('detailedFindings').innerHTML = analysisData.scripts.map(s => {
                    const colorClass = s.isTracker ? 'border-red-500' : (s.isThirdParty ? 'border-amber-500' : 'border-emerald-500');
                    const threatIcons = [];
                    if(s.isTracker) threatIcons.push('üîç');
                    if(s.suspicious && s.suspicious.length > 0) threatIcons.push('‚ö†Ô∏è');
                    if(s.entropy && s.entropy > 5) threatIcons.push('üîê');
                    return `<div class="card border-l-4 ${colorClass}"><div class="font-bold text-sm mb-1">${threatIcons.join(' ')} ${escapeHtml((s.type === 'external' ? s.domain : 'Inline').substring(0, 50))}</div><div class="text-xs text-slate-400 break-all">${escapeHtml((s.src || s.code).substring(0, 80))}</div>${s.entropy ? `<div class="text-xs text-slate-500 mt-1">Entropy: ${s.entropy}/8</div>` : ''}${s.suspicious && s.suspicious.length ? `<div class="mt-2 flex flex-wrap gap-1">${s.suspicious.map(sus => `<span class="tag">${sus}</span>`).join('')}</div>` : ''}</div>`;
                }).join('');

                buildGraph();
                addTimelineEvent('‚úì Analysis complete', 'success');
            } catch (e) {
                addTimelineEvent(`Error: ${e.message}`, 'error');
                alert('Failed: ' + e.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Analyze';
            }
        }

        document.getElementById('analyzeBtn').addEventListener('click', analyzeWebsite);
        document.getElementById('urlInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') analyzeWebsite(); });
    </script>
</body>
</html>
